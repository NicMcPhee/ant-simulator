!function(){this.antsimulator={}}.call(this),function(){var t;t=this.antsimulator,t.Ant=function(){function i(i,s){this.sim=i,this.pos=null!=s?s:new t.Vec,this.angle=2*Math.random()*Math.PI,this.speed=.4*(.2*Math.random()+.8)*this.sim.layerScale,this.stomach=0,this.homeRecency=0,this.age=0}return i.prototype.sniff=function(i){var s,e,h,r,n,o;return e=3*this.sim.layerScale,s=Math.PI/4,h=this.pos.get().add(t.Vec.fromAngleDist(this.angle+s,e)),r=this.pos.get().add(t.Vec.fromAngleDist(this.angle-s,e)),n=i.sample(h),o=i.sample(r),.01>n&&(n=0),.01>o&&(o=0),n-o},i.prototype.update=function(){var i,s,e,h;return this.age++,this.stomach*=1-this.sim.CONFIG.FOOD_TRAIL_FALLOFF_RATE,this.homeRecency*=1-this.sim.CONFIG.NEST_FALLOFF_RATE,this.isInNest()&&(this.stomach=0,this.homeRecency=1),e=this.stomach+this.sim.layers.food.take(this.pos,1),this.stomach=e,this.isHunting()?(h=this.sniff(this.sim.layers.food),0===h&&(h=this.sniff(this.sim.layers.foodtrail))):h=this.sniff(this.sim.layers.nesttrail),this.sim.layers.foodtrail.mark(this.pos,.01*this.stomach),this.sim.layers.nesttrail.mark(this.pos,.1*this.homeRecency),h>0&&(this.angle+=parseFloat(this.sim.CONFIG.ANT_TURN_SPEED)),0>h&&(this.angle-=parseFloat(this.sim.CONFIG.ANT_TURN_SPEED)),s=Math.max(0,1-this.sim.layers.foodtrail.sample(this.pos)),this.angle+=2*(Math.random()-.5)*s*this.sim.CONFIG.JITTER_MAGNITUDE,this.pos.add(t.Vec.fromAngleDist(this.angle,this.speed)),i=this.pos.get().bound(0,0,0,this.sim.w,this.sim.h,0),i.eq(this.pos)?void 0:(this.angle=2*Math.random()*Math.PI,this.pos=i)},i.prototype.isInNest=function(){return new t.Vec(this.sim.w/2,this.sim.h).sub(this.pos).mag()<10},i.prototype.isHunting=function(){return this.stomach<.1&&this.homeRecency>.01},i.prototype.draw=function(t){return t.fillStyle="#fff",t.save(),t.beginPath(),t.translate(this.pos.x,this.pos.y),t.arc(0,0,.25*this.sim.layerScale,0,2*Math.PI),t.fill(),t.restore()},i}()}.call(this),function(){var t,i;i=this.antsimulator,t={SCALE:4,NUM_ANTS:1e3,STEPS_PER_FRAME:5,ANT_TURN_SPEED:.7,SHOW_ANTS:1,JITTER_MAGNITUDE:.5,NEST_FALLOFF_RATE:.01,FOOD_TRAIL_FALLOFF_RATE:.01,NEST_TRAIL_FADE_RATE:.01,FOOD_TRAIL_FADE_RATE:.005},i.AntSim=function(){function s(){this.CONFIG=t,this.frame=0,this.layerScale=this.CONFIG.SCALE,this.createCanvas(),this.createLayers(),this.ants=[],this.update()}return s.prototype.createCanvas=function(){return this.b=document.body,this.c=document.getElementsByTagName("canvas")[0],this.a=this.c.getContext("2d"),this.w=this.c.width=this.c.clientWidth,this.h=this.c.height=this.c.clientHeight,document.body.clientWidth},s.prototype.createLayers=function(){return this.layers={},this.layers.nesttrail=new i.NestTrail(this),this.layers.foodtrail=new i.FoodTrail(this),this.layers.food=new i.Food(this),this.compositor=new i.LayerCompositor(this)},s.prototype.createAndRemoveAnts=function(){for(;this.ants.length<this.CONFIG.NUM_ANTS;)this.ants.push(new i.Ant(this,new i.Vec(this.w/2,this.h)));return this.ants.length>this.CONFIG.NUM_ANTS?this.ants=this.ants.slice(0,this.CONFIG.NUM_ANTS):void 0},s.prototype.drawLayers=function(){return this.a.putImageData(this.compositor.getImageData(this.layers),0,0),this.a.drawImage(this.c,0,0,this.layerScale*this.w,this.layerScale*this.h)},s.prototype.update=function(){var t,i,s,e,h,r,n,o,a,u;for(this.createAndRemoveAnts(),i=h=0,o=this.CONFIG.STEPS_PER_FRAME;o>=0?o>h:h>o;i=o>=0?++h:--h){a=this.layers;for(s in a)e=a[s],e.update();for(u=this.ants,r=0,n=u.length;n>r;r++)t=u[r],t.update()}return this.draw(),this.frame++},s.prototype.draw=function(){var t,i,s,e,h,r=this;for(this.a.clearRect(0,0,this.w,this.h),this.drawLayers(),h=this.ants,i=0,s=h.length;s>i;i++)t=h[i],parseInt(this.CONFIG.SHOW_ANTS)&&t.draw(this.a);return e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame,e(function(){return r.update()})},s}()}.call(this),function(){var t,i,s,e,h={}.hasOwnProperty,r=function(t,i){function s(){this.constructor=t}for(var e in i)h.call(i,e)&&(t[e]=i[e]);return s.prototype=i.prototype,t.prototype=new s,t.__super__=i.prototype,t};t=this.antsimulator,t.Layer=function(){function t(t){var i,s,e;for(this.sim=t,this.w=~~(this.sim.w/this.sim.layerScale),this.h=~~(this.sim.h/this.sim.layerScale),this.buffer=[],i=s=0,e=this.w*this.h;e>=0?e>s:s>e;i=e>=0?++s:--s)this.buffer.push(this.initCell(i%this.w,Math.floor(i/this.h)))}return t.prototype.initCell=function(){return 0},t.prototype.update=function(){},t.prototype.mul=function(t){var i,s,e,h,r,n;for(r=this.buffer,n=[],i=e=0,h=r.length;h>e;i=++e)s=r[i],n.push(this.buffer[i]=s*t);return n},t.prototype.add=function(t){var i,s,e,h,r,n;for(r=this.buffer,n=[],i=e=0,h=r.length;h>e;i=++e)s=r[i],n.push(this.buffer[i]=s-t);return n},t.prototype.blur=function(t){var i,s,e,h,r,n,o,a,u,f,l,c,p,m,y,d,_;for(s=[],l=this.buffer,i=o=0,f=l.length;f>o;i=++o){for(h=l[i],r=i%this.w,n=(i-r)/this.h,e=0,d=a=c=Math.max(0,r-1),p=Math.min(this.w-1,r+1);p>=c?p>=a:a>=p;d=p>=c?++a:--a)for(_=u=m=Math.max(0,n-1),y=Math.min(this.h-1,n+1);y>=m?y>=u:u>=y;_=y>=m?++u:--u)e+=this.buffer[d+_*this.w]*t;e+=h*(1-t),s[i]=e/(9*t+(1-t))||0}return this.buffer=s},t.prototype.mark=function(t,i){var s;return s=this.posToIndex(t),null!=this.buffer[s]?this.buffer[s]+=i:void 0},t.prototype.sample=function(t){var i;return i=this.posToIndex(t),this.buffer[i]||0},t.prototype.take=function(t,i){var s,e;return s=this.posToIndex(t),null!=this.buffer[s]?(e=Math.min(this.buffer[s],i),this.buffer[s]-=e,e):0},t.prototype.posToIndex=function(t){return t=t.get().mul(1/this.sim.layerScale),Math.floor(t.x)+Math.floor(t.y)*this.w},t}(),t.NestTrail=function(t){function s(){return i=s.__super__.constructor.apply(this,arguments)}return r(s,t),s.prototype.update=function(){return this.mul(1-this.sim.CONFIG.NEST_TRAIL_FADE_RATE),this.buffer[this.w/2+this.h/2*this.w]=1e3},s}(t.Layer),t.FoodTrail=function(t){function i(){return s=i.__super__.constructor.apply(this,arguments)}return r(i,t),i.prototype.update=function(){return this.mul(1-this.sim.CONFIG.FOOD_TRAIL_FADE_RATE)},i}(t.Layer),t.Food=function(i){function s(){return e=s.__super__.constructor.apply(this,arguments)}return r(s,i),s.prototype.initCell=function(){return Math.random()<2e-4?100:0},s.prototype.update=function(){return 0===this.sim.frame%10&&this.blur(.002),Math.random()<.01?this.mark(new t.Vec(Math.random()*this.w*this.sim.layerScale,Math.random()*this.h*this.sim.layerScale),100):void 0},s}(t.Layer),t.LayerCompositor=function(){function t(t){this.sim=t,this.w=~~(this.sim.w/this.sim.layerScale),this.h=~~(this.sim.h/this.sim.layerScale),this.imageData=document.createElement("CANVAS").getContext("2d").createImageData(this.w,this.h)}return t.prototype.getImageData=function(t){var i,s,e,h,r,n,o,a;for(s=this.imageData.data,h=o=0,a=this.w*this.h;a>=0?a>o:o>a;h=a>=0?++o:--o)r=4*h,n=.13,e=.11,i=.1,n+=.5*t.nesttrail.buffer[h],e+=.1*t.nesttrail.buffer[h],n+=.65*t.food.buffer[h],e+=1*t.food.buffer[h],i+=2.5*t.foodtrail.buffer[h],e+=1.7*t.foodtrail.buffer[h],s[r+0]=255*n,s[r+1]=255*e,s[r+2]=255*i,s[r+3]=255;return this.imageData},t}()}.call(this),function(){var t;t=this.antsimulator,t.Vec=function(){function i(t,i,s){this.x=null!=t?t:0,this.y=null!=i?i:0,this.z=null!=s?s:0}return i.prototype.set=function(t,i,s){return this.x=null!=t?t:0,this.y=null!=i?i:0,this.z=null!=s?s:0,this},i.prototype.get=function(){return new t.Vec(this.x,this.y,this.z)},i.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},i.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},i.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},i.prototype.div=function(t){return this.x/=t,this.y/=t,this.z/=t,this},i.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},i.prototype.normalize=function(){var t;return t=this.mag(),this.x/=t,this.y/=t,this.z/=t,this},i.prototype.bound=function(t,i,s,e,h,r){return this.x=Math.min(e,Math.max(t,this.x)),this.y=Math.min(h,Math.max(i,this.y)),this.z=Math.min(r,Math.max(s,this.z)),this},i.prototype.eq=function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},i}(),t.Vec.fromAngleDist=function(i,s){return new t.Vec(s*Math.cos(i),s*Math.sin(i))}}.call(this),function(){}.call(this);