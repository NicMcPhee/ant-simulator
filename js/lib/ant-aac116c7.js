!function(){var s;s=this.antsimulator,s.Ant=function(){function t(t,i){this.sim=t,this.pos=null!=i?i:new s.Vec,this.angle=2*Math.random()*Math.PI,this.speed=.4*(.2*Math.random()+.8)*this.sim.layerScale,this.stomach=0,this.homeRecency=0,this.age=0}return t.prototype.sniff=function(t){var i,h,e,a,o,n;return h=3*this.sim.layerScale,i=Math.PI/4,e=this.pos.get().add(s.Vec.fromAngleDist(this.angle+i,h)),a=this.pos.get().add(s.Vec.fromAngleDist(this.angle-i,h)),o=t.sample(e),n=t.sample(a),.01>o&&(o=0),.01>n&&(n=0),o-n},t.prototype.update=function(){var t,i,h,e;return this.age++,this.stomach*=1-this.sim.CONFIG.FOOD_TRAIL_FALLOFF_RATE,this.homeRecency*=1-this.sim.CONFIG.NEST_FALLOFF_RATE,this.isInNest()&&(this.stomach=0,this.homeRecency=1),h=this.stomach+this.sim.layers.food.take(this.pos,1),this.stomach=h,this.isHunting()?(e=this.sniff(this.sim.layers.food),0===e&&(e=this.sniff(this.sim.layers.foodtrail))):e=this.sniff(this.sim.layers.nesttrail),this.sim.layers.foodtrail.mark(this.pos,.01*this.stomach),this.sim.layers.nesttrail.mark(this.pos,.1*this.homeRecency),e>0&&(this.angle+=parseFloat(this.sim.CONFIG.ANT_TURN_SPEED)),0>e&&(this.angle-=parseFloat(this.sim.CONFIG.ANT_TURN_SPEED)),i=Math.max(0,1-this.sim.layers.foodtrail.sample(this.pos)),this.angle+=2*(Math.random()-.5)*i*this.sim.CONFIG.JITTER_MAGNITUDE,this.pos.add(s.Vec.fromAngleDist(this.angle,this.speed)),t=this.pos.get().bound(0,0,0,this.sim.w,this.sim.h,0),t.eq(this.pos)?void 0:(this.angle=2*Math.random()*Math.PI,this.pos=t)},t.prototype.isInNest=function(){return new s.Vec(this.sim.w/2,this.sim.h).sub(this.pos).mag()<10},t.prototype.isHunting=function(){return this.stomach<.1&&this.homeRecency>.01},t.prototype.draw=function(s){return s.fillStyle="#fff",s.save(),s.beginPath(),s.translate(this.pos.x,this.pos.y),s.arc(0,0,.25*this.sim.layerScale,0,2*Math.PI),s.fill(),s.restore()},t}()}.call(this);