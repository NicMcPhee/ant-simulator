!function(){var t,r,i,e,o={}.hasOwnProperty,s=function(t,r){function i(){this.constructor=t}for(var e in r)o.call(r,e)&&(t[e]=r[e]);return i.prototype=r.prototype,t.prototype=new i,t.__super__=r.prototype,t};t=this.antsimulator,t.Layer=function(){function t(t){var r,i,e;for(this.sim=t,this.w=~~(this.sim.w/this.sim.layerScale),this.h=~~(this.sim.h/this.sim.layerScale),this.buffer=[],r=i=0,e=this.w*this.h;e>=0?e>i:i>e;r=e>=0?++i:--i)this.buffer.push(this.initCell(r%this.w,Math.floor(r/this.h)))}return t.prototype.initCell=function(){return 0},t.prototype.update=function(){},t.prototype.mul=function(t){var r,i,e,o,s,n;for(s=this.buffer,n=[],r=e=0,o=s.length;o>e;r=++e)i=s[r],n.push(this.buffer[r]=i*t);return n},t.prototype.add=function(t){var r,i,e,o,s,n;for(s=this.buffer,n=[],r=e=0,o=s.length;o>e;r=++e)i=s[r],n.push(this.buffer[r]=i-t);return n},t.prototype.blur=function(t){var r,i,e,o,s,n,h,u,a,f,p,l,c,m,y,d,b;for(i=[],p=this.buffer,r=h=0,f=p.length;f>h;r=++h){for(o=p[r],s=r%this.w,n=(r-s)/this.h,e=0,d=u=l=Math.max(0,s-1),c=Math.min(this.w-1,s+1);c>=l?c>=u:u>=c;d=c>=l?++u:--u)for(b=a=m=Math.max(0,n-1),y=Math.min(this.h-1,n+1);y>=m?y>=a:a>=y;b=y>=m?++a:--a)e+=this.buffer[d+b*this.w]*t;e+=o*(1-t),i[r]=e/(9*t+(1-t))||0}return this.buffer=i},t.prototype.mark=function(t,r){var i;return i=this.posToIndex(t),null!=this.buffer[i]?this.buffer[i]+=r:void 0},t.prototype.sample=function(t){var r;return r=this.posToIndex(t),this.buffer[r]||0},t.prototype.take=function(t,r){var i,e;return i=this.posToIndex(t),null!=this.buffer[i]?(e=Math.min(this.buffer[i],r),this.buffer[i]-=e,e):0},t.prototype.posToIndex=function(t){return t=t.get().mul(1/this.sim.layerScale),Math.floor(t.x)+Math.floor(t.y)*this.w},t}(),t.NestTrail=function(t){function i(){return r=i.__super__.constructor.apply(this,arguments)}return s(i,t),i.prototype.update=function(){return this.mul(1-this.sim.CONFIG.NEST_TRAIL_FADE_RATE),this.buffer[this.w/2+this.h/2*this.w]=1e3},i}(t.Layer),t.FoodTrail=function(t){function r(){return i=r.__super__.constructor.apply(this,arguments)}return s(r,t),r.prototype.update=function(){return this.mul(1-this.sim.CONFIG.FOOD_TRAIL_FADE_RATE)},r}(t.Layer),t.Food=function(r){function i(){return e=i.__super__.constructor.apply(this,arguments)}return s(i,r),i.prototype.initCell=function(){return Math.random()<2e-4?100:0},i.prototype.update=function(){return 0===this.sim.frame%10&&this.blur(.002),Math.random()<.01?this.mark(new t.Vec(Math.random()*this.w*this.sim.layerScale,Math.random()*this.h*this.sim.layerScale),100):void 0},i}(t.Layer),t.LayerCompositor=function(){function t(t){this.sim=t,this.w=~~(this.sim.w/this.sim.layerScale),this.h=~~(this.sim.h/this.sim.layerScale),this.imageData=document.createElement("CANVAS").getContext("2d").createImageData(this.w,this.h)}return t.prototype.getImageData=function(t){var r,i,e,o,s,n,h,u;for(i=this.imageData.data,o=h=0,u=this.w*this.h;u>=0?u>h:h>u;o=u>=0?++h:--h)s=4*o,n=.13,e=.11,r=.1,n+=.5*t.nesttrail.buffer[o],e+=.1*t.nesttrail.buffer[o],n+=.65*t.food.buffer[o],e+=1*t.food.buffer[o],r+=2.5*t.foodtrail.buffer[o],e+=1.7*t.foodtrail.buffer[o],i[s+0]=255*n,i[s+1]=255*e,i[s+2]=255*r,i[s+3]=255;return this.imageData},t}()}.call(this);